<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="sale_order_view_form_inherit" model="ir.ui.view">
        <field name="name">sale.order.form.inherit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='sale_order_template_id']" position="after">
                <field name="sproject_id" invisible="1"/>
                <field name="serv_assig" 
                    widget="selection_badge" 
                    decoration-muted="serv_assig == 'no_assig'"
                    decoration-primary ="serv_assig == 'assig'"
                    />

                <label for="origen_id" />
                    <div name="dest_div" class="d-flex">
                        <field name="origen_id" options="{'no_open': True,'no_create': True, 'no_edit':True}"/>
                        <span class="oe_inline o_form_label mx-3">Destino</span>
                        <field name="dest_id" options="{'no_open': True,'no_create': True, 'no_edit':True}"/>
                    </div>

                <field name="incidencia" options="{'no_open': True,'no_create': True, 'no_edit':True}"/>
            </xpath>
        </field>
    </record>

    <record id="view_order_form_inherit_project_updates" model="ir.ui.view">
        <field name="name">sale.order.form.inherit.project.updates</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <notebook position="inside">
                <page string="Avances del Proyecto" name="project_updates">
                    <field name="project_sub_updates" mode="list,form" create="false" delete="0" widget="many2many_list">
                        <list create="0" delete="0">
                            <field name="date"/>
                            <field name="task_id"/>
                            <field name="unit_progress"/>
                            <field name="actual_progress"/>
                            <field name="sale_current" sum="Total"/>
                            <field name="responsible_id" placeholder="Responsable del servicio"
                                widget="many2one_avatar_user" options="{'no_open': True,'no_create': True, 'no_edit':True}"/>
                            <field name="state" widget="badge"
                                string="Estado Facturacion" 
                                decoration-danger="state == 'no_fact'"
                                decoration-success="state == 'fact'"
                                />
                            <field name="datefact"/>
                            <field name="factura" options="{'no_edit': True, 'no_create': True}"/>
                            
                                
                            <button name="action_mark_invoiced" 
                                    type="object" 
                                    class="btn btn-success" 
                                    icon="fa-check" 
                                    title="Marcar como facturado"
                                    invisible="state == 'fact'"/>
                            <button name="action_mark_not_invoiced" 
                                    type="object" 
                                    class="btn btn-danger" 
                                    icon="fa-times" 
                                    title="Marcar como facturado"
                                    invisible="state == 'no_fact'"/>
                        </list>
                        <form>
                        
                            <header>
                                <field name="state" widget="statusbar" statusbar_visible="no_fact,fact" readonly="1"/>
                                <button name="action_mark_invoiced" type="object" 
                                    string="Marcar como facturado" class="btn-success" icon="fa-check"
                                    invisible="state == 'fact'"
                                    groups="project_modificaciones.group_sub_update_mark_invoiced"/>
                                <button name="action_mark_not_invoiced" type="object" string="Marcar como no facturado" class="btn-danger" icon="fa-times"
                                    invisible="state == 'no_fact'"
                                    groups="project_modificaciones.group_sub_update_mark_invoiced"/>
                            </header>
                            <sheet>
                                <div class="float-end fs-6 border-0">
                                    <field name="serv_assig" widget="badge"
                                           decoration-muted="serv_assig == 'no_assig'"
                                           decoration-primary ="serv_assig == 'assig'"
                                           />
                                </div>
                                <separator string="Datos del servicio"/>
                               
                                <group>
                                    <group>
                                        <field name="project_id"/>
                                    </group>
                                    <group>
                                        <field name="update_id" readonly="1"/>
                                    </group>
                                </group>
                                <h3><field name="task_id" string="Partida" placeholder="Seleccione la tarea" style="width: 100%" options="{'no_create': True}"/></h3>
                                <group>
                                    <group>
                                        <field name="cliente" options="{'no_open': True}"/>
                                        <field name="disciplina" options="{'no_open': True}"/>
                                        <field name="date" string="Fecha de avance"/>
                                    </group>
                                    <group>
                                        <field name="sale_order_id"/>
                                        <field name="state" invisible="1" readonly="1"/>
<!--                                        <field name="analitica"/>-->
                                    </group>
                                </group>
                                <group>
                                    <group string="Responsable Interno">
                                        <field name="responsible_id" placeholder="Responsable del servicio"
                                            widget="many2one_avatar_user" options="{'no_open': True,'no_create': True, 'no_edit':True}"/>
                                    </group>
                                    <group string="Responsable Cliente">
                                        <field name="supervisorplanta" string="Supervisor"/>
                                        <field name="area"/>
                                    </group>
                                </group>
                                   
                                <separator string="Avance Actual"/>
                                <group>
                                    <group>
                                        <field name="unit_progress" widget="float" digits="[12,6]"/>
                                        <field name="virtual_quant_progress" string="Unidades entregadas" widget="float" digits="[12,6]"/>
                                    </group>
                                    <group>
                                        <field name="actual_progress_percentage" widget="percentage"/>
                                        <field name="missing_quant" digits="[12,6]"/>
                                        <field name="proj" invisible="1"/>
                                        <field name="projid" invisible="1"/>
                                        <field name="projname" invisible="1"/>
                                    </group>
                                </group>
                
                                <separator string="Avance del servicio"/>
                                <group>
                                    <group>
                                        <field name="estado" invisible="1"/>
                                        <field name="virtual_quant_progress" string="Unidades entregadas" digits="[12,6]"/>
                                        <field name="sale_current"/>
                                    </group>
                                    <group>
                                        <field name="quant_total" string="Unidades a entregar" widget="float" digits="[12,6]"/>
                                        <field name="virtual_total_progress" string="Progreso total" widget="progressbar"/>
                                    </group>
                                </group>
                                
                                <separator string="Estado de la facturacion"/>
                                <group>
                                    <group>
                                        <field name="bitacorapmv"/>
                                        <field name="numlic" string="#Bitacora/Licencia"/>
                                        <field name="estimado" readonly="0"/>
                                        <field name="datefact" readonly="0"/>
                                        <field name="is_invoiced" invisible="1"/>
                                        <field name="sale_total"/>
                                    </group>
                                    <group>
                                        <field name="om"/>
                                        <field name="cot"/>
                                        <field name="cotizacion"/>
                                        <field name="avanceparc" readonly="0"/>
                                        <field name="factura" options="{'no_edit': True, 'no_create': True}" readonly="0"/>
                                        <field name="sale_actual"/>
                                        <field name="sale_missing"/>
                                    </group>
                                    
                                    <field name="domain" invisible="1"/>
                                </group>
                                <separator string="Seguimiento"/>
                                <field name="write_date" string="Modificado por ult. vez"/>
                            </sheet>
                            <chatter/>
                        </form>
                    </field>
                </page>
            </notebook>
        </field>
    </record>
</odoo>