<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="sale_order_view_form_inherit" model="ir.ui.view">
        <field name="name">sale.order.form.inherit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">

            <xpath expr="//field[@name='partner_id']" position="attributes">
                <attribute name="domain">[('tipo_contacto', '=', 'Cliente')]</attribute>
            </xpath>

            <xpath expr="//h1/field[@name='name']" position="attributes">
                <attribute name="readonly">state in ('sale', 'cancel')</attribute>
            </xpath>

            <xpath expr="//header/button[@name='action_preview_sale_order']" position="before">
                <button name="action_open_change_name_wizard"
                        type="object"
                        string="Renombrar"
                        class="btn btn-primary"/>
            </xpath>

            <xpath expr="//notebook" position="inside">
                <page string="Avances del Proyecto" name="project_updates">
                    <field name="project_sub_updates" mode="list,form" create="false" delete="0"
                           widget="many2many_list">
                        <list create="0" delete="0">
                            <field name="name" string="Avance"/>
                            <field name="project_id" string="Proyecto"/>
                            <field name="date" string="Elaborado"/>
                            <field name="producto" string="Servicio"/>
                            <field name="unit_progress" string="Unidades"/>
                            <field name="sale_current" string="Valor" sum="Total"/>
                            <field name="virtual_total_progress" widget="progressbar" string="Progreso"/>
                            <field name="responsible_id" placeholder="Responsable del servicio"
                                   widget="many2one_avatar_user"
                                   options="{'no_open': True,'no_create': True, 'no_edit':True}"/>
                            <field name="avances_state" widget="badge"
                                   decoration-success="avances_state == 'assigned' or avances_state == 'done'"
                                   decoration-info="avances_state == 'confirmed'"
                                   decoration-warning="avances_state == 'draft'"/>
                        </list>

                        <form>
                            <header>
                                <field name="avances_state" widget="statusbar" readonly="1"/>
                            </header>
                            <sheet>
                                <div class="oe_title">
                                    <h1 class="d-flex flex-row">
                                        <field name="name"/>
                                    </h1>
                                </div>
                                <separator string="Datos Internos del Servicio"/>
                                <group>
                                    <group>
                                        <field name="sale_order_id"/>
                                    </group>
                                    <group>
                                        <field name="project_id" readonly="avances_state in ['assigned']"/>
                                    </group>
                                </group>
                                <h4>
                                    <field name="task_id" style="width: 100%" readonly="avances_state in ['assigned']"/>
                                </h4>
                                <group>
                                    <group>
                                        <field name="cliente_project"/>
                                        <field name="especialidad" widget="many2many_tags"/>
                                        <field name="coordinador_project" widget="many2one_avatar_user"/>
                                    </group>
                                    <group>
                                        <field name="update_id" readonly="avances_state in ['assigned']"/>
                                        <field name="gerente_project" widget="many2one_avatar_user"/>
                                        <field name="supervisor_project" widget="many2one_avatar_user"/>
                                    </group>
                                </group>
                                <separator string="Información Producto A Entregar"/>
                                <group>
                                    <group>
                                        <field name="producto" readonly="avances_state in ['assigned']"/>
                                        <field name="unidad_medida"/>
                                    </group>
                                    <group>
                                        <field name="especialidad_producto"/>
                                        <field name="precio_unidad"/>
                                    </group>
                                </group>
                                <separator string="Datos Generales Del Avance"/>
                                <group>
                                    <group>
                                        <field name="oc_pedido"/>
                                        <field name="ct" readonly="avances_state in ['confirmed', 'assigned']"/>
                                        <field name="especialidad_trabajo"/>
                                    </group>
                                    <group>
                                        <field name="date" readonly="avances_state in ['confirmed', 'assigned']"/>
                                        <field name="or_rfq" readonly="avances_state in 'assigned'"/>
                                        <field name="no_cotizacion" readonly="avances_state in 'assigned'"/>
                                    </group>
                                </group>
                                <separator string="Descripción Detallada Del Avance"/>
                                <group>
                                    <field name="planta" readonly="avances_state in ['confirmed', 'assigned']"/>
                                </group>
                                <group>
                                    <group>
                                        <field name="hora_inicio" widget="float_time"
                                               readonly="avances_state in ['confirmed', 'assigned']"/>
                                        <separator string="Responsable Cliente" widget="badge"/>
                                        <field name="supervisorplanta" widget="many2one_avatar_user"
                                               readonly="avances_state in ['confirmed', 'assigned']"/>
                                        <field name="area_equipo"
                                               readonly="avances_state in ['confirmed', 'assigned']"/>
                                    </group>
                                    <group>
                                        <field name="hora_termino" widget="float_time"
                                               readonly="avances_state in ['confirmed', 'assigned']"/>
                                        <separator string="Responsable Interno" widget="badge"/>
                                        <field name="responsible_id" widget="many2one_avatar_user"
                                               readonly="avances_state in ['confirmed', 'assigned']"/>
                                        <field name="licencia" readonly="avances_state in ['assigned']"/>
                                    </group>
                                </group>
                                <separator string="Avance Actual"/>
                                <group>
                                    <group>
                                        <field name="unit_progress" widget="float" digits="[12,6]"
                                               readonly="avances_state in ['confirmed', 'assigned']"/>
                                        <field name="virtual_quant_progress" string="Unidades entregadas" widget="float"
                                               digits="[12,6]"/>
                                    </group>
                                    <group>
                                        <field name="actual_progress_percentage" widget="percentage"/>
                                        <field name="missing_quant" digits="[12,6]"/>
                                        <field name="proj" invisible="1"/>
                                        <field name="projid" invisible="1"/>
                                        <field name="projname" invisible="1"/>
                                    </group>
                                </group>
                                <separator string="Avance del servicio"/>
                                <group>
                                    <group>
                                        <field name="estado" invisible="1"/>
                                        <field name="virtual_quant_progress" string="Unidades entregadas"
                                               digits="[12,6]"/>
                                        <field name="sale_current"/>
                                    </group>
                                    <group>
                                        <field name="quant_total" string="Unidades a entregar" widget="float"
                                               digits="[12,6]"/>
                                        <field name="virtual_total_progress" string="Progreso total"
                                               widget="progressbar"/>
                                    </group>
                                </group>
                                <group>
                                    <group>
                                        <field name="costo_avance_formateado"/>
                                    </group>
                                </group>
                                <group>
                                    <field name="planta_domain" invisible="1"/>
                                    <field name="supervisor_domain" invisible="1"/>
                                </group>
                                <separator string="Estado de la facturacion"/>
                                <group>
                                    <group>
                                        <field name="bitacorapmv"/>
                                        <field name="numlic" string="#Bitacora/Licencia"/>
                                        <field name="estimado" readonly="0"/>
                                        <field name="datefact" readonly="0"/>
                                        <field name="is_invoiced" invisible="1"/>
                                        <field name="sale_total"/>
                                    </group>
                                    <group>
                                        <field name="om"/>
                                        <field name="cot"/>
                                        <field name="cotizacion"/>
                                        <field name="avanceparc" readonly="0"/>
                                        <field name="factura" options="{'no_edit': True, 'no_create': True}"
                                               readonly="0"/>
                                        <field name="sale_actual"/>
                                        <field name="sale_missing"/>
                                    </group>
                                    <field name="domain" invisible="1"/>
                                </group>
                                <separator string="Seguimiento"/>
                                <group>
                                    <field name="notas" string="Comentarios Pertinentes:" readonly="1"/>
                                </group>
                                <group>
                                    <group>
                                        <field name="write_date" string="Modificado por ult. vez"/>
                                        <field name="is_transferible" widget="boolean_toggle" readonly="1"
                                               invisible="1"/>
                                    </group>
                                    <group>
                                        <field name="created_by" widget="many2one_avatar_user"
                                               options="{'no_create': True}"/>
                                        <field name="is_avance_preliminar" widget="boolean_toggle" readonly="1"
                                               invisible="1"/>
                                    </group>
                                </group>
                            </sheet>
                        </form>
                    </field>
                </page>
            </xpath>
        </field>
    </record>
</odoo>