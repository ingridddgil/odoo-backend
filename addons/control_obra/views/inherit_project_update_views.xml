<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="project_update_view_form_inherit" model="ir.ui.view">
        <field name="name">project.update.view.form.inherit</field>
        <field name="model">project.update</field>
        <field name="inherit_id" ref="project.project_update_view_form"/>
        <field name="arch" type="xml">

            <xpath expr="//sheet" position="inside">
                <div class="oe_stat_button" name="button_box">
                    <button name="%(action_update_sub_updates_wizard)d"
                            type="action"
                            context="{'default_update_id': id, 'default_project_id': project_id.id}"
                            string="Seleccionar Avances"
                            class="btn btn-primary"
                            icon="fa-file-text"/>
                </div>
            </xpath>

            <xpath expr="//field[@name='progress']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//group" position="after">
                <separator string="Avance"/>
                <notebook>
                    <page string="Partidas">
                        <field name="sub_update_ids" widget="one2many"
                               options="{'no_create': True, 'no_create_edit': True}"
                               context="{'default_project_id': project_id, 'default_update_id': id,}"
                               string="Avance">
                            <form string="Tareas actualizadas" class="control_de_obra_view">
                                <header>
                                    <field name="avances_state" widget="statusbar" readonly="1"/>
                                </header>
                                <style>
                                    .o_form_view .o_cell.o_wrap_label .o_form_label[for="ct_0"],
                                    .o_form_view .o_cell.o_wrap_label .o_form_label[for="producto_0"],
                                    .o_form_view .o_cell.o_wrap_label .o_form_label[for="planta_0"],
                                    .o_form_view .o_cell.o_wrap_label .o_form_label[for="hora_inicio_0"],
                                    .o_form_view .o_cell.o_wrap_label .o_form_label[for="hora_termino_0"],
                                    .o_form_view .o_cell.o_wrap_label .o_form_label[for="supervisorplanta_0"],
                                    .o_form_view .o_cell.o_wrap_label .o_form_label[for="responsible_id_0"],
                                    .o_form_view .o_cell.o_wrap_label .o_form_label[for="licencia_0"],
                                    .o_form_view .o_cell.o_wrap_label .o_form_label[for="unit_progress_0"] {
                                    color: #FF0000 !important;
                                    font-weight: bold !important;
                                    }

                                    .o_form_view input#ct_0,
                                    .o_form_view input#producto_0,
                                    .o_form_view input#planta_0,
                                    .o_form_view input#hora_inicio_0,
                                    .o_form_view input#hora_termino_0,
                                    .o_form_view input#supervisorplanta_0,
                                    .o_form_view input#responsible_id_0,
                                    .o_form_view input#licencia_0,
                                    .o_form_view input#unit_progress_0 {
                                    border: none !important;
                                    border-bottom: 1px solid #FF0000 !important;
                                    border-radius: 0 !important;
                                    box-shadow: none !important;
                                    background: linear-gradient(to bottom, transparent 96%, #FF0000 96%) !important;
                                    padding-bottom: 0px !important;
                                    }
                                </style>
                                <sheet>
                                    <div class="oe_title">
                                        <h1 class="d-flex flex-row">
                                            <field name="name"/>
                                        </h1>
                                    </div>

                                    <separator string="Datos Internos del servicio"/>
                                    <group>
                                        <group>
                                            <field name="sale_order_id"/>
                                        </group>
                                        <group>
                                            <field name="project_id" domain="[('is_proyecto_obra', '=', True)]"/>
                                        </group>
                                    </group>
                                    <h4>
                                        <field name="task_id" string="Partida" placeholder="Seleccione La Tarea"
                                               style="width: 100%" options="{'no_create': True}"
                                        />
                                    </h4>
                                    <group>
                                        <group>
                                            <field name="cliente_project" options="{'no_open': True}"/>
                                            <field name="especialidad" widget="many2many_tags"
                                                   options="{'no_open': True, 'color_field': 'color'}"/>
                                            <field name="coordinador_project" widget="many2one_avatar_user"/>
                                        </group>
                                        <group>
                                            <field name="update_id"
                                                   domain="[('project_id', '=', project_id), ('sub_update_ids', '=', False)]"
                                                   context="{'default_project_id': project_id}"/>
                                            <field name="gerente_project" widget="many2one_avatar_user"/>
                                            <field name="supervisor_project" widget="many2one_avatar_user"/>
                                        </group>
                                    </group>

                                    <separator string="Datos Generales Del Avance"/>
                                    <group>
                                        <group>
                                            <field name="oc_pedido"/>
                                            <field name="ct" onchange="1"
                                                   options="{'no_quick_create': True, 'no_create_edit': False}"/>
                                            <field name="especialidad_trabajo"/>
                                        </group>

                                        <group>
                                            <field name="date"/>
                                            <field name="or_rfq"/>
                                            <field name="no_cotizacion"/>
                                        </group>
                                    </group>

                                    <separator string="Descripción Detallada Del Avance"/>
                                    <group>
                                        <field name="planta" domain="planta_domain"
                                               options="{'no_quick_create': False, 'no_create_edit': True}"
                                               context="{'default_cliente': cliente}"/>
                                    </group>
                                    <group>
                                        <group>
                                            <field name="hora_inicio" widget="float_time"
                                                   placeholder="Formato de 24hrs: 08:00"/>
                                            <separator string="Responsable Cliente" widget="badge"/>
                                            <field name="supervisorplanta" widget="many2one_avatar_user"
                                                   domain="supervisor_domain"
                                                   options="{'no_quick_create': True, 'no_create_edit': True}"
                                                   context="{'default_cliente': cliente}"/>
                                            <!--Cliente-->
                                            <field name="area_equipo"/>
                                        </group>
                                        <group>
                                            <field name="hora_termino" widget="float_time"
                                                   placeholder="Formato de 24hrs: 08:00"/>
                                            <separator string="Responsable Interno" widget="badge"/>
                                            <field name="responsible_id" widget="many2one_avatar_user"
                                                   options="{'no_quick_create': True, 'no_create_edit': True}"/>
                                            <!--Ayasa-->
                                            <field name="licencia"/>-->
                                        </group>
                                    </group>

                                    <separator string="Avance Actual"/>
                                    <group>
                                        <group>
                                            <field name="unit_progress" widget="float" digits="[12,6]"/>
                                            <field name="virtual_quant_progress" string="Unidades entregadas"
                                                   widget="float" digits="[12,6]"/>
                                        </group>
                                        <group>
                                            <field name="actual_progress_percentage" widget="percentage"/>
                                            <field name="missing_quant" digits="[12,6]"/>
                                            <field name="proj" invisible="1"/>
                                            <field name="projid" invisible="1"/>
                                            <field name="projname" invisible="1"/>
                                        </group>
                                    </group>

                                    <separator string="Avance del servicio"/>
                                    <group>
                                        <group>
                                            <field name="estado" invisible="1"/>
                                            <field name="virtual_quant_progress" string="Unidades entregadas"
                                                   digits="[12,6]"/>
                                            <field name="sale_current"/>
                                        </group>
                                        <group>
                                            <field name="quant_total" string="Unidades a entregar" widget="float"
                                                   digits="[12,6]"/>
                                            <field name="virtual_total_progress" string="Progreso total"
                                                   widget="progressbar"/>
                                        </group>
                                    </group>
                                    <group>
                                        <group>
                                            <field name="costo_avance_formateado"/>
                                        </group>
                                    </group>
                                    <group>
                                        <field name="planta_domain" invisible="1"/>
                                        <field name="supervisor_domain" invisible="1"/>
                                    </group>

                                    <separator string="Estado de la facturacion"/>
                                    <group>
                                        <group>
                                            <field name="bitacorapmv"/>
                                            <field name="numlic" string="#Bitacora/Licencia"/>
                                            <field name="estimado"/>
                                            <field name="datefact"/>
                                            <field name="is_invoiced" invisible="1"/>
                                            <field name="sale_total"/>
                                        </group>
                                        <group>
                                            <field name="om"/>
                                            <field name="cot"/>
                                            <field name="avanceparc"
                                                   readonly="0"/> <!--readonly="0"-->
                                            <field name="factura" options="{'no_edit': True, 'no_create': True}"
                                                   readonly="0"/> <!--readonly="0"-->
                                            <field name="sale_actual"/>
                                            <field name="sale_missing"/>
                                        </group>

                                        <field name="domain" invisible="1"/>

                                    </group>
                                    <separator string="Seguimiento"/>
                                    <group>
                                        <field name="notas" string="Comentarios Pertinentes:"/>
                                    </group>
                                    <group>
                                        <group>
                                            <field name="write_date" string="Modificado por ult. vez"/>
                                            <field name="is_transferible" widget="boolean_toggle" readonly="1"
                                                   invisible="1"/>
                                        </group>
                                        <group>
                                            <field name="created_by" widget="many2one_avatar_user"
                                                   options="{'no_create': True}"/>
                                            <field name="is_avance_preliminar" widget="boolean_toggle" readonly="1"
                                                   invisible="1"/>
                                        </group>
                                    </group>
                                </sheet>
                            </form>
                            <list delete="false">
                                <control>
                                    <create name="add_update_task" string="Crear Avance"/>
                                </control>
                                <!--<field name="id" invisible="1"/>-->
                                <field name="partida_linea" optional="show" />
                                <field name="date"/>
                                <field name="task_id" optional="show"/>
                                <field name="responsible_id" optional="show"/>
                                <field name="unit_progress" optional="hide"/>
                                <field name="virtual_quant_progress" string="Unidades entregadas" optional="hide"/>
                                <field name="actual_progress_percentage" widget="percentage" optional="hide"/>
                                <field name="total_progress_percentage" string="Progreso total" widget="percentage"
                                       optional="show"/>
                                <field name="missing_quant" optional="hide"/>
                                <field name="sale_actual" string="Por facturar" optional="show"/>
                                <button name="action_unlink_from_update"
                                        type="object"
                                        icon="fa-chain-broken"
                                        help="Devuelve este avance al estado 'Confirmado' para reasignarlo."
                                        confirm="¿Estás seguro de que quieres desvincular esta línea de avance?"
                                        width="1px"
                                />
                            </list>
                        </field>
                    </page>
                </notebook>
                <separator string="Por facturar"/>
                <h2>
                    <field name="sale_actual_text" string="Subtotal entregado" decoration-bf="1" decoration-info="1"/>
                </h2>
                <group>
                    <group>
                        <field name="sale_current"/>
                    </group>
                    <group>
                        <field name="sale_actual" decoration-bf="1" decoration-info="1"/>
                        <field name="sale_missing"/>
                        <field name="sale_total"/>
                    </group>
                </group>
            </xpath>
        </field>
    </record>

    <record id="project_update_view_kanban" model="ir.ui.view">
        <field name="name">project.update.view.kanban.inherit</field>
        <field name="model">project.update</field>
        <field name="inherit_id" ref="project.project_update_view_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="attributes">
                <attribute name="default_order">id desc</attribute>
            </xpath>
        </field>
    </record>

    <record id="project_update_view_list" model="ir.ui.view">
        <field name="name">project.update.view.list.inherit</field>
        <field name="model">project.update</field>
        <field name="inherit_id" ref="project.project_update_view_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//list" position="attributes">
                <attribute name="default_order">id desc</attribute>
            </xpath>
        </field>
    </record>

    <record id="project_update_view_search" model="ir.ui.view">
        <field name="name">project.update.view.search.inherit</field>
        <field name="model">project.update</field>
        <field name="inherit_id" ref="project.project_update_view_search"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">
                <searchpanel>
                    <field name="status" select="one" enable_counters="1"/>
                </searchpanel>
                <filter string="Con Avances" name="with_advances" domain="[('sub_update_ids', '!=', False)]"/>
                <filter string="Sin Avances" name="without_advances" domain="[('sub_update_ids', '=', False)]"/>
            </xpath>
        </field>
    </record>
</odoo>